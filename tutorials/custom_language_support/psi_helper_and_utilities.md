---
title: 6. PSI Helpers and Utilities——PSI助手和工具
---


### 6.1. Define helper methods for generated PSI elements——为生成的PSI元素定义辅助方法

If we want to have custom methods in PSI classes we need to define them separately and ask Grammar-Kit to embed them into generated code.

**CN:**  如果我们希望在PSI类中有自定义方法，我们需要分别定义它们，并要求Grammar-Kit将它们嵌入生成的代码中。

Let's define a utility class with these helper methods.

**CN:**  让我们用这些辅助方法定义一个实用程序类。

```java
package com.simpleplugin.psi.impl;

import com.intellij.lang.ASTNode;
import com.intellij.navigation.ItemPresentation;
import com.intellij.psi.*;
import com.simpleplugin.SimpleIcons;
import com.simpleplugin.psi.*;
import org.jetbrains.annotations.Nullable;

import javax.swing.*;

public class SimplePsiImplUtil {
  public static String getKey(SimpleProperty element) {
    ASTNode keyNode = element.getNode().findChildByType(SimpleTypes.KEY);
    if (keyNode != null) {
      // IMPORTANT: Convert embedded escaped spaces to simple spaces
      return keyNode.getText().replaceAll("\\\\ ", " ");
    } else {
      return null;
    }
  }

  public static String getValue(SimpleProperty element) {
    ASTNode valueNode = element.getNode().findChildByType(SimpleTypes.VALUE);
    if (valueNode != null) {
      return valueNode.getText();
    } else {
      return null;
    }
  }
}
```

Note that the `SimpleProperty` interface referenced in the code above is generated by the parser. Also note that the `element.getKey` method used in `getPresentableText` will not be defined - it's a method generated by the parser, which we'll fix below.

**CN:**  注意，上面代码中引用的`SimpleProperty`接口是由解析器生成的。还请注意，`getPresentableText`中使用的`element.getKey`方法将不被定义—它是由解析器生成的方法，我们将在下面对其进行修正。

### 6.2. Update grammar and regenerate the parser——更新语法并重新生成解析器

Now we tell to use this utility class in the grammar file via `psiImplUtilClass` attribute.

**CN:**  现在，我们通过`psiImplUtilClass`属性在语法文件中使用这个实用工具类。

To tell which methods for which PSI classes must be used we specify methods for particular rule.

**CN:**  为了确定哪些方法必须用于哪些PSI类，我们指定了特定规则的方法。

```java
{
  parserClass="com.simpleplugin.parser.SimpleParser"

  extends="com.intellij.extapi.psi.ASTWrapperPsiElement"

  psiClassPrefix="Simple"
  psiImplClassSuffix="Impl"
  psiPackage="com.simpleplugin.psi"
  psiImplPackage="com.simpleplugin.psi.impl"

  elementTypeHolderClass="com.simpleplugin.psi.SimpleTypes"
  elementTypeClass="com.simpleplugin.psi.SimpleElementType"
  tokenTypeClass="com.simpleplugin.psi.SimpleTokenType"

  psiImplUtilClass="com.simpleplugin.psi.impl.SimplePsiImplUtil"
}

simpleFile ::= item_*

private item_ ::= (property|COMMENT|CRLF)

property ::= (KEY? SEPARATOR VALUE?) | KEY {methods=[getKey getValue]}
```

After we made our changes to the grammar we can regenerate the parser and PSI classes.

**CN:**  修改完语法之后，我们可以重新生成解析器和PSI类。

### 6.3. Define a utility to search properties——定义用于搜索属性的实用程序

Now we need a utility class to search PSI elements for defined properties over the project.
We will use this utility later when implementing code assistance.

**CN:**  现在，我们需要一个实用工具类来搜索PSI元素，以查找项目上定义的属性。
        稍后在实现代码帮助时，我们将使用这个实用程序。

```java
{% include /code_samples/simple_language_plugin/src/com/simpleplugin/SimpleUtil.java %}
```
